# LLM OS — Claude Code Project Context

You are working on **LLM OS**, an operating system where every application is generated by AI from natural language prompts. This is not an agent framework or chatbot UI — it is a real OS with sandboxed execution and capability-based security.

## Core Values — READ THESE FIRST

Every line of code you write, every feature you add, every decision you make must align with these values. They are non-negotiable.

**1. Protect the user first.**
Their privacy and their integrity, through all means possible. No telemetry, no data collection, no phoning home without explicit consent. Generated apps run in sandboxes. Capabilities are gated by user approval. When in doubt, deny access.

**2. Empower the user.**
The OS exists to serve the user, not to restrict them. Users should be able to generate and run any software they wish — as long as it is not detrimental to humanity as a whole. Never add artificial limitations. The tools should exist to do things efficiently.

**3. Take a piece, leave a piece.**
This is open source built by a community. Code that is contributed should not damage or disrupt the core idea. If you improve something, contribute it back. If you find a bug, report it.

**4. Nothing is perfect.**
These rules aren't perfect and neither is this code. We can always improve — as long as the core intent isn't violated. Ship working code, iterate, improve.

## Architecture

```
Generated Apps (sandboxed iframes / WASM)
         ↕ postMessage
Shell UI (window manager, prompt bar, capability dialogs)
         ↕ HTTP API
Kernel (LLM gateway, static analyzer, capabilities, storage)
         ↕ fetch
LLM Providers (Ollama local, Claude API, OpenAI API)
```

## Project Structure

```
src/
  server.js              — HTTP server, API endpoints, static file serving
  kernel/
    config.js            — Environment config (.env loader)
    gateway.js           — LLM routing (Ollama for simple, Claude for complex)
    analyzer.js          — Static analysis (regex-based, blocks eval/injection)
    capabilities.js      — Per-app capability whitelist
  sdk/
    sdk.js               — In-sandbox SDK (runs inside iframes, postMessage bridge)
  shell/
    index.html           — Desktop UI (prompt bar, windows, modals, log)
    sandbox.js           — Iframe sandbox manager (creates, injects SDK, kills)
```

## How It Works

1. User types a prompt ("make me a calculator")
2. `gateway.js` sanitizes input, routes to best LLM, gets generated HTML/JS
3. `analyzer.js` scans the code for eval(), parent access, fetch(), etc.
4. Shell shows capability approval dialog to the user
5. User approves → `sandbox.js` creates an iframe with `sandbox="allow-scripts"` + strict CSP
6. SDK is injected into the iframe; app communicates with kernel via postMessage
7. Kernel validates every SDK call against the app's approved capabilities

## Key Principles for Code

- **No dependencies unless absolutely necessary.** The prototype has zero npm runtime deps.
- **Vanilla JS/HTML/CSS.** No React, Vue, Angular. Keep it simple and auditable.
- **Every component works standalone.** Mock what you need, test in isolation.
- **Security by default.** Sandboxes deny everything. Capabilities must be explicitly granted.
- **No telemetry, no tracking, no analytics.** User privacy is non-negotiable.
- **Dark color scheme.** Background: #0d0d1a, text: #e0e0f0, accent: #6c63ff.

## When Modifying Code

- Read existing code before changing it. Understand patterns before proposing alternatives.
- The static analyzer (`analyzer.js`) must NEVER use an LLM — it must be deterministic.
- The SDK (`sdk.js`) runs inside untrusted iframes — it must never trust the host directly.
- The gateway (`gateway.js`) must sanitize ALL user input before passing to any LLM.
- Generated apps must never be able to escape their sandbox. If you find an escape vector, fix it immediately and file an issue.

## Running the Prototype

```bash
cp .env.example .env     # Set OLLAMA_URL or ANTHROPIC_API_KEY
node src/server.js       # http://localhost:3000
```

## Open Contribution Areas

See CONTRIBUTING.md for detailed prompts for each component. Priority areas:
- WASM sandbox (replace iframes with Wasmtime/Extism)
- Cryptographic capability tokens (HMAC-SHA256 via Web Crypto)
- App registry with content addressing (SQLite + SHA-256)
- Bootable image (Buildroot/Alpine, boots into kiosk browser)
- Custom Rust microkernel (long-term, `no_std`, UEFI boot)
