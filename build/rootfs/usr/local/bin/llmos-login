#!/bin/sh
# Auto-login script for tty1 — shows system status, then drops to shell

clear
cat /etc/motd

# Show IP addresses
echo "  Network:"
for iface in $(ls /sys/class/net/ 2>/dev/null | grep -v lo); do
    ip=$(ip -4 addr show "$iface" 2>/dev/null | grep -oP '(?<=inet )\S+' | head -1)
    if [ -n "$ip" ]; then
        echo "    $iface: $ip"
        echo ""
        echo "  → Open http://${ip%/*}:3000 in your browser"
    fi
done

echo ""

# Service status
printf "  Docker:  "
if docker info >/dev/null 2>&1; then
    echo "running"
else
    echo "not running"
fi

printf "  LLM OS:  "
if rc-service llmos status >/dev/null 2>&1; then
    echo "running (port 3000)"
else
    echo "not running — try: rc-service llmos start"
fi

printf "  Claude:  "
if command -v claude >/dev/null 2>&1; then
    if grep -q 'ANTHROPIC_API_KEY=.\+' /opt/llm-os/.env 2>/dev/null; then
        echo "ready (API key configured)"
    else
        echo "installed (needs API key — see llmos-config)"
    fi
else
    if grep -q 'ANTHROPIC_API_KEY=.\+' /opt/llm-os/.env 2>/dev/null; then
        echo "not installed (run: llmos-claude to install + launch)"
    else
        echo "not installed (run: llmos-claude — needs API key)"
    fi
fi

echo ""
echo "  llmos-config   — configure API keys and Ollama URL"
echo "  llmos-claude   — install + launch Claude Code CLI"
echo ""

exec /bin/sh -l
